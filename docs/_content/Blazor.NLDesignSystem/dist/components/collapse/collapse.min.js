/*!
NL Design System Componenten library 0.1.1, build date 27-06-2020
Copyright 2011-2020 The NL Design System Authors
Copyright 2011-2020 Duo
Author: DUO & The NL Design System Authors
Author URI: https://nl-design-system.gitlab.io/nl-design-system/
License: EUPL v1.2
License URL: https://joinup.ec.europa.eu/software/page/eupl5
Version: 0.1.1
*/
var SlideToggle_1=require("../../core/animations/SlideToggle"),utils_1=require("./../../core/utils"),TOGGLE_CLASS="collapse__details--open",TOGGLE_TITLE_CLASS="collapse__title--open",Collapse=function(){function t(t){var e=this;(this.host=t)&&(this.host.hasOwnProperty("unoCollapse")||(this.host.unoCollapse=!0,t.hasAttribute("x-uno-collapse")||t.setAttribute("x-uno-collapse",""),t.hasAttribute("data-collapse-target")&&console.warn("[data-collapse-target] is deprecated and will be removed in version 4 in favor of [x-uno-collapse-target]"),t.hasAttribute("data-collapse-group")&&console.warn("[data-collapse-group] is deprecated and will be removed in version 4 in favor of [x-uno-collapse-group]"),this.details=this.findTarget(t),this.host.addEventListener("click",this),this.host.addEventListener("keydown",this),this.host.addEventListener("collapse-open",this),this.host.addEventListener("collapse-close",this),this.details.addEventListener("keydown",function(t){(utils_1.Utils.IsKeyPressed(t,"Escape")||utils_1.Utils.IsKeyPressed(t,""))&&e.close(),utils_1.Utils.IsKeyPressed(t,"Tab")&&utils_1.Utils.FocusChild(t,e.details.querySelectorAll("li a"))}),this.setupAnimation(),this.groupCollapses(t)))}return t.prototype.close=function(){if(this.details.classList.contains(TOGGLE_CLASS)){var t=document.createEvent("CustomEvent");t.initCustomEvent("collapse-close",!0,!0,this.details),this.host.dispatchEvent(t),this.host.focus()}},t.prototype.open=function(){if(!this.details.classList.contains(TOGGLE_CLASS)){var t=document.createEvent("CustomEvent");t.initCustomEvent("collapse-open",!0,!0,this.details),this.host.dispatchEvent(t),this.focusFirstChild()}},t.prototype.focusFirstChild=function(){var t=this.details.querySelector("li a");t&&t.focus()},t.prototype.destroy=function(){var e=this;this.host.removeEventListener("collapse-open",this),this.host.removeEventListener("collapse-close",this),this.host.removeEventListener("click",this),this.host.removeEventListener("keydown",this),delete this.host.unoCollapse,this.details.removeEventListener("keydown",this),this.details.removeEventListener("uno-animation-end",this),this.details.removeEventListener("uno-animation-progress",this),this.groupedCollapses&&(this.groupedCollapses.forEach(function(t){t.removeEventListener("collapse-open",e)}),this.groupedCollapses=null)},t.prototype.handleEvent=function(t){switch(t.currentTarget){case this.host:switch(t.type){case"click":this.onTitleClick();break;case"keydown":this.onTitleKeyDown(t);break;case"collapse-open":this.onCollapseOpen(t);break;case"collapse-close":this.onCollapseClose(t)}break;case this.details:this["onDetails"+utils_1.Utils.CamelCase(t.type)](t);break;default:"collapse-open"===t.type&&this.onCollapseGroupOpen(t)}},t.prototype.toggle=function(){this.details=this.findTarget(this.host),this.details.classList.contains(TOGGLE_CLASS)?this.close():this.open()},t.prototype.onCollapseOpen=function(t){t.defaultPrevented||this.animate.toggle(!0)},t.prototype.onCollapseClose=function(t){t.defaultPrevented||this.animate.toggle(!1)},t.prototype.onCollapseGroupOpen=function(t){t.currentTarget!==this.host&&t.detail!==this.details&&this.close()},t.prototype.onTitleClick=function(){this.toggle()},t.prototype.onTitleKeyDown=function(t){(utils_1.Utils.IsKeyPressed(t,"Enter")||utils_1.Utils.IsKeyPressed(t," "))&&(t.preventDefault(),this.toggle())},t.prototype.onDetailsUnoAnimationEnd=function(){var t=this.details.classList.contains(TOGGLE_CLASS);this.host.classList.remove(TOGGLE_TITLE_CLASS),t&&this.host.classList.add(TOGGLE_TITLE_CLASS),this.host.setAttribute("aria-expanded",t.toString()),this.details.setAttribute("aria-expanded",t.toString())},t.prototype.onDetailsUnoAnimationProgress=function(t){this.detailsSibling.style.paddingTop=Math.round(t.detail)+"px"},t.prototype.findTarget=function(t){var e;if(t.hasAttribute("x-uno-collapse-target")?e=document.getElementById(t.getAttribute("x-uno-collapse-target")):t.hasAttribute("data-collapse-target")?e=document.getElementById(t.getAttribute("data-collapse-target")):t.nextElementSibling&&t.nextElementSibling.classList.contains("collapse__details")&&(e=t.nextElementSibling),!e)throw new Error("Collapse cannot find collapse target");return e.hasAttribute("id")||e.setAttribute("id",utils_1.Utils.GenerateUID()),e.classList.contains(TOGGLE_CLASS)&&this.host.classList.add(TOGGLE_TITLE_CLASS),this.setAria(e),e},t.prototype.groupCollapses=function(s){var i,t=["x-uno-collapse-group","data-collapse-group"],o=!1;if(t.forEach(function(t){if(s.hasAttribute(t)){var e=s.getAttribute(t);i=document.querySelectorAll("["+t+'="'+e+'"]'),o=!0}}),!o)for(;s.parentElement&&!i;)s=s.parentElement,t.forEach(function(t){s.hasAttribute(t)&&(i=s.querySelectorAll("[x-uno-collapse]"))});if(i){this.groupedCollapses=[];for(var e=0;e<i.length;e++)this.groupedCollapses.push(i.item(e)),i.item(e).addEventListener("collapse-open",this)}},t.prototype.setupAnimation=function(){this.animate=new SlideToggle_1.SlideToggle(this.details),this.animate.toggleClass=TOGGLE_CLASS,this.animate.animationDuration=1,this.details.addEventListener("uno-animation-end",this),"tr"===this.details.nodeName.toLowerCase()&&(this.details.addEventListener("uno-animation-progress",this),this.detailsSibling=document.createElement("tr"),this.detailsSibling.classList.add("collapse__table-divider"),this.detailsSibling.innerHTML="<td></td>",this.details.nextElementSibling?this.details.parentNode.insertBefore(this.detailsSibling,this.details.nextElementSibling):this.details.parentNode.appendChild(this.detailsSibling),this.detailsSibling=this.detailsSibling.firstElementChild)},t.prototype.setAria=function(t){var e=t.classList.contains(TOGGLE_CLASS);t.setAttribute("aria-expanded",e.toString()),t.hasAttribute("role")||t.setAttribute("role","region"),this.host.setAttribute("role","button"),this.host.setAttribute("tabindex","0"),this.host.setAttribute("aria-expanded",e.toString()),this.host.setAttribute("aria-controls",t.getAttribute("id"))},t}();exports.Collapse=Collapse;