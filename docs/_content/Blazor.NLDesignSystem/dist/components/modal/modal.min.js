/*!
NL Design System Componenten library 0.1.1, build date 27-06-2020
Copyright 2011-2020 The NL Design System Authors
Copyright 2011-2020 Duo
Author: DUO & The NL Design System Authors
Author URI: https://nl-design-system.gitlab.io/nl-design-system/
License: EUPL v1.2
License URL: https://joinup.ec.europa.eu/software/page/eupl5
Version: 0.1.1
*/
var utils_1=require("./../../core/utils"),RESIZE_TIMEOUT=200,Modal=function(){function e(e){this.element=e,this.focusableElementsString="\n        a[href],\n        area[href],\n        input:not([disabled]),\n        select:not([disabled]),\n        textarea:not([disabled]),\n        button:not([disabled]),\n        iframe,\n        object,\n        embed,\n        *[tabindex],\n        *[contenteditable]",this.closeListener=this.onClose.bind(this),this.keyDownListener=this.onKeyDown.bind(this),this.resizeListener=this.onResize.bind(this),e.setAttribute("tabindex","-1"),e.querySelector(".modal__close-button")&&e.querySelector(".modal__close-button").addEventListener("click",this.closeListener),e.addEventListener("keydown",this.keyDownListener),window.addEventListener("resize",this.resizeListener),this.setAria()}return e.prototype.onKeyDown=function(e){if(utils_1.Utils.IsKeyPressed(e,"Escape"))e.preventDefault(),this.close();else if(utils_1.Utils.IsKeyPressed(e,"Tab")){var t,i,o;(t=Array.prototype.slice.call(this.element.querySelectorAll(this.focusableElementsString),0)).sort(function(e,t){var i=e.getAttribute("tabindex"),o=t.getAttribute("tabindex");return o<i?1:i<o?-1:0}),i=document.querySelector(":focus"),o=t.length;var s=Math.max(Array.prototype.indexOf.call(t,i),0);e.shiftKey?0===s?t[o-1].focus():t[s-1].focus():s===o-1?t[0].focus():t[s+1].focus(),e.preventDefault()}},e.prototype.open=function(){this.previousFocus=document.activeElement,this.element.classList.add("modal--open"),this.resize(),this.setFocus()},e.prototype.close=function(){this.element.classList.remove("modal--open"),this.previousFocus&&this.previousFocus.focus()},e.prototype.destroy=function(){clearTimeout(this.resizeTimeout),this.element.querySelector(".modal__close-button")&&this.element.querySelector(".modal__close-button").removeEventListener("click",this.closeListener),this.element.removeEventListener("keydown",this.keyDownListener),window.removeEventListener("resize",this.resizeListener)},e.prototype.resize=function(){var e,t=this.element.querySelector(".modal__body"),i=this.element.querySelector(".modal__title"),o=this.element.querySelector(".modal__footer");t.style.maxHeight="100%",e=getComputedStyle(this.element.querySelector(".modal__content"));var s=parseInt(e.height);if(s<parseInt(getComputedStyle(t).height)){var n=s-parseInt(e.paddingTop)-parseInt(e.paddingBottom)-parseInt(getComputedStyle(t).marginTop)-parseInt(getComputedStyle(t).marginBottom)-10;i&&(n-=utils_1.Utils.CalculateElementHeight(i)),o&&(n-=utils_1.Utils.CalculateElementHeight(o)),t.style.maxHeight=n+"px"}},e.prototype.onClose=function(e){e.preventDefault(),this.close()},e.prototype.onResize=function(){clearTimeout(this.resizeTimeout),this.resizeTimeout=window.setTimeout(this.resize.bind(this),RESIZE_TIMEOUT)},e.prototype.setAria=function(){this.element.setAttribute("role","dialog");var e=this.element.querySelector(".modal__title h1");e&&(e.hasAttribute("id")||e.setAttribute("id",utils_1.Utils.GenerateUID()),this.element.setAttribute("aria-labelledby",e.getAttribute("id")))},e.prototype.setFocus=function(){for(var e,t=[".modal__body input, .modal__body textarea",".btn--primary",".btn",".modal__close-button"],i=0;i<t.length;i++){var o=t[i];if(e=this.element.querySelector(o)){e.focus();break}}},e}();exports.Modal=Modal;